apiVersion: v1
data:
  idpHostName: keycloak.devqseok.tk
  imageRegistry: qlik-docker-qsefe.bintray.io
  ingressAuthUrl: http://qliksense-edge-auth.default.svc.cluster.local:8080/v1/auth
  ingressClass: qlik-nginx
  realmName: QSEoK
  staticIpName: keycloak-ip
  storageClassName: ""
kind: ConfigMap
metadata:
  labels:
    app: keycloak
    release: qliksense
  name: qliksense-keycloak-configs-cgkdthcff2
  namespace: default
---
apiVersion: v1
data:
  keycloak.sh: |
    #!/usr/bin/env bash

    set -o errexit
    set -o nounset

    exec /opt/jboss/tools/docker-entrypoint.sh -b 0.0.0.0 -Dkeycloak.import=/realm/realm.json -c standalone.xml
kind: ConfigMap
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
  name: qliksense-keycloak-sh
  namespace: default
---
apiVersion: v1
data:
  keycloak.cli: |
    embed-server --std-out=echo
    batch
    ## Sets the node identifier to the node name (= pod name). Node identifiers have to be unique. They can have a
    ## maximum length of 23 characters. Thus, the chart's fullname template truncates its length accordingly.
    /subsystem=transactions:write-attribute(name=node-identifier, value=${jboss.node.name})


    # Allow log level to be configured via environment variable
    /subsystem=logging/console-handler=CONSOLE:write-attribute(name=level, value=${env.WILDFLY_LOGLEVEL:INFO})
    /subsystem=logging/root-logger=ROOT:write-attribute(name=level, value=${env.WILDFLY_LOGLEVEL:INFO})

    # Add dedicated eventsListener config element to allow configuring elements.
    /subsystem=keycloak-server/spi=eventsListener:add()
    /subsystem=keycloak-server/spi=eventsListener/provider=jboss-logging:add(enabled=true)

    # Propagate success events to INFO instead of DEBUG, to expose successful logins for log analysis
    /subsystem=keycloak-server/spi=eventsListener/provider=jboss-logging:write-attribute(name=properties.success-level,value=info)
    /subsystem=keycloak-server/spi=eventsListener/provider=jboss-logging:write-attribute(name=properties.error-level,value=warn)


    # Configure datasource to use explicit query timeout in seconds
    /subsystem=datasources/data-source=KeycloakDS/:write-attribute(name=query-timeout,value=${env.DB_QUERY_TIMEOUT:300})

    # Configure datasource to connection before use
    /subsystem=datasources/data-source=KeycloakDS/:write-attribute(name=validate-on-match,value=${env.DB_VALIDATE_ON_MATCH:true})

    # Configure datasource to try all other connections before failing
    /subsystem=datasources/data-source=KeycloakDS/:write-attribute(name=use-fast-fail,value=${env.DB_USE_CAST_FAIL:false})



    run-batch
    stop-embedded-server
kind: ConfigMap
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
  name: qliksense-keycloak-startup
  namespace: default
---
apiVersion: v1
data:
  password: ""
  username: a2V5Y2xvYWs=
kind: Secret
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
  name: qliksense-keycloak-db
  namespace: default
type: Opaque
---
apiVersion: v1
data:
  realm.json: ewogICAgInJlYWxtIjogIlFTRW9LIiwKICAgICJlbmFibGVkIjogdHJ1ZSwKICAgICJzc2xSZXF1aXJlZCI6ICJleHRlcm5hbCIsCiAgICAicmVnaXN0cmF0aW9uQWxsb3dlZCI6IGZhbHNlLAogICAgImxvZ2luVGhlbWUiOiAicWxpa3RoZW1lIiwKICAgICJhY2NvdW50VGhlbWUiOiAicWxpa3RoZW1lIiwKICAgICJhZG1pblRoZW1lIjogInFsaWt0aGVtZSIsCiAgICAiZW1haWxUaGVtZSI6ICJxbGlrdGhlbWUiLAogICAgInJlcXVpcmVkQ3JlZGVudGlhbHMiOiBbCiAgICAgICAgInBhc3N3b3JkIgogICAgXSwKICAgICJkZWZhdWx0R3JvdXBzIjogWwogICAgICAgICIvRXZlcnlvbmUiCiAgICBdLAogICAgInJvbGVzIjogewogICAgICAgICJyZWFsbSI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAidXNlciIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiVXNlciBwcml2aWxlZ2VzIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJhZG1pbiIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQWRtaW5pc3RyYXRvciBwcml2aWxlZ2VzIgogICAgICAgICAgICB9CiAgICAgICAgXQogICAgfSwKICAgICJncm91cHMiOiBbCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBY2NvdW50aW5nIiwKICAgICAgICAgICAgInBhdGgiOiAiL0FjY291bnRpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFkbWluaXN0cmF0b3JzIiwKICAgICAgICAgICAgInBhdGgiOiAiL0FkbWluaXN0cmF0b3JzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFbmdpbmVlcmluZyIsCiAgICAgICAgICAgICJwYXRoIjogIi9FbmdpbmVlcmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXZlcnlvbmUiLAogICAgICAgICAgICAicGF0aCI6ICIvRXZlcnlvbmUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1hcmtldGluZyIsCiAgICAgICAgICAgICJwYXRoIjogIi9NYXJrZXRpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlNhbGVzIiwKICAgICAgICAgICAgInBhdGgiOiAiL1NhbGVzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTdXBwb3J0IiwKICAgICAgICAgICAgInBhdGgiOiAiL1N1cHBvcnQiCiAgICAgICAgfQogICAgXSwKICAgICJ1c2VycyI6IFsKICAgICAgICB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJiYXJiIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiQmFyYiIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJTdG92aW4iLAogICAgICAgICAgICAiZW1haWwiOiAiYmFyYkBxbGlrLmV4YW1wbGUiLAogICAgICAgICAgICAiY3JlZGVudGlhbHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ4eHh4eCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkQWN0aW9ucyI6IFsKICAgICAgICAgICAgICAgICJVUERBVEVfUEFTU1dPUkQiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZWFsbVJvbGVzIjogWwogICAgICAgICAgICAgICAgInVzZXIiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJjbGllbnRSb2xlcyI6IHsKICAgICAgICAgICAgICAgICJhY2NvdW50IjogWwogICAgICAgICAgICAgICAgICAgICJtYW5hZ2UtYWNjb3VudCIsCiAgICAgICAgICAgICAgICAgICAgInZpZXctcHJvZmlsZSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiLAogICAgICAgICAgICAgICAgIi9TdXBwb3J0IgogICAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJldmFuIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiRXZhbiIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJIaWdobWFuIiwKICAgICAgICAgICAgImVtYWlsIjogImV2YW5AcWxpay5leGFtcGxlIiwKICAgICAgICAgICAgImNyZWRlbnRpYWxzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhc3N3b3JkIiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAieHh4eHgiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZXF1aXJlZEFjdGlvbnMiOiBbCiAgICAgICAgICAgICAgICAiVVBEQVRFX1BBU1NXT1JEIgogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVhbG1Sb2xlcyI6IFsKICAgICAgICAgICAgICAgICJ1c2VyIgogICAgICAgICAgICBdLAogICAgICAgICAgICAiY2xpZW50Um9sZXMiOiB7CiAgICAgICAgICAgICAgICAiYWNjb3VudCI6IFsKICAgICAgICAgICAgICAgICAgICAibWFuYWdlLWFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICJ2aWV3LXByb2ZpbGUiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJncm91cHMiOiBbCiAgICAgICAgICAgICAgICAiL0VuZ2luZWVyaW5nIiwKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiCiAgICAgICAgICAgIF0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgInVzZXJuYW1lIjogImZyYW5rbGluIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiRnJhbmtsaW4iLAogICAgICAgICAgICAibGFzdE5hbWUiOiAiR2xhbWFydCIsCiAgICAgICAgICAgICJlbWFpbCI6ICJmcmFua2xpbkBxbGlrLmV4YW1wbGUiLAogICAgICAgICAgICAiY3JlZGVudGlhbHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ4eHh4eCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkQWN0aW9ucyI6IFsKICAgICAgICAgICAgICAgICJVUERBVEVfUEFTU1dPUkQiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZWFsbVJvbGVzIjogWwogICAgICAgICAgICAgICAgInVzZXIiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJjbGllbnRSb2xlcyI6IHsKICAgICAgICAgICAgICAgICJhY2NvdW50IjogWwogICAgICAgICAgICAgICAgICAgICJtYW5hZ2UtYWNjb3VudCIsCiAgICAgICAgICAgICAgICAgICAgInZpZXctcHJvZmlsZSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiLAogICAgICAgICAgICAgICAgIi9TYWxlcyIKICAgICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAidXNlcm5hbWUiOiAiaGFybGV5IiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiSGFybGV5IiwKICAgICAgICAgICAgImxhc3ROYW1lIjogIktpZmZlIiwKICAgICAgICAgICAgImVtYWlsIjogImhhcmxleUBxbGlrLmV4YW1wbGUiLAogICAgICAgICAgICAiY3JlZGVudGlhbHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ4eHh4eCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkQWN0aW9ucyI6IFsKICAgICAgICAgICAgICAgICJVUERBVEVfUEFTU1dPUkQiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZWFsbVJvbGVzIjogWwogICAgICAgICAgICAgICAgInVzZXIiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJjbGllbnRSb2xlcyI6IHsKICAgICAgICAgICAgICAgICJhY2NvdW50IjogWwogICAgICAgICAgICAgICAgICAgICJtYW5hZ2UtYWNjb3VudCIsCiAgICAgICAgICAgICAgICAgICAgInZpZXctcHJvZmlsZSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiLAogICAgICAgICAgICAgICAgIi9TYWxlcyIKICAgICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAidXNlcm5hbWUiOiAibWFybmUiLAogICAgICAgICAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAgICAgICAgICJlbWFpbFZlcmlmaWVkIjogdHJ1ZSwKICAgICAgICAgICAgImZpcnN0TmFtZSI6ICJNYXJuZSIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJQcm9iZXR0cyIsCiAgICAgICAgICAgICJlbWFpbCI6ICJtYXJuZUBxbGlrLmV4YW1wbGUiLAogICAgICAgICAgICAiY3JlZGVudGlhbHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ4eHh4eCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkQWN0aW9ucyI6IFsKICAgICAgICAgICAgICAgICJVUERBVEVfUEFTU1dPUkQiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZWFsbVJvbGVzIjogWwogICAgICAgICAgICAgICAgInVzZXIiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJjbGllbnRSb2xlcyI6IHsKICAgICAgICAgICAgICAgICJhY2NvdW50IjogWwogICAgICAgICAgICAgICAgICAgICJtYW5hZ2UtYWNjb3VudCIsCiAgICAgICAgICAgICAgICAgICAgInZpZXctcHJvZmlsZSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiLAogICAgICAgICAgICAgICAgIi9NYXJrZXRpbmciCiAgICAgICAgICAgIF0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgInVzZXJuYW1lIjogInBldGEiLAogICAgICAgICAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAgICAgICAgICJlbWFpbFZlcmlmaWVkIjogdHJ1ZSwKICAgICAgICAgICAgImZpcnN0TmFtZSI6ICJQZXRhIiwKICAgICAgICAgICAgImxhc3ROYW1lIjogIlNhbW1vbiIsCiAgICAgICAgICAgICJlbWFpbCI6ICJwZXRhQHFsaWsuZXhhbXBsZSIsCiAgICAgICAgICAgICJjcmVkZW50aWFscyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXNzd29yZCIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInh4eHh4IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVxdWlyZWRBY3Rpb25zIjogWwogICAgICAgICAgICAgICAgIlVQREFURV9QQVNTV09SRCIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlYWxtUm9sZXMiOiBbCiAgICAgICAgICAgICAgICAidXNlciIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNsaWVudFJvbGVzIjogewogICAgICAgICAgICAgICAgImFjY291bnQiOiBbCiAgICAgICAgICAgICAgICAgICAgIm1hbmFnZS1hY2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAidmlldy1wcm9maWxlIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICAiZ3JvdXBzIjogWwogICAgICAgICAgICAgICAgIi9FbmdpbmVlcmluZyIsCiAgICAgICAgICAgICAgICAiL0V2ZXJ5b25lIgogICAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJwaGlsbGllIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiUGhpbGxpZSIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJTbWVlZCIsCiAgICAgICAgICAgICJlbWFpbCI6ICJwaGlsbGllQHFsaWsuZXhhbXBsZSIsCiAgICAgICAgICAgICJjcmVkZW50aWFscyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXNzd29yZCIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInh4eHh4IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVxdWlyZWRBY3Rpb25zIjogWwogICAgICAgICAgICAgICAgIlVQREFURV9QQVNTV09SRCIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlYWxtUm9sZXMiOiBbCiAgICAgICAgICAgICAgICAidXNlciIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNsaWVudFJvbGVzIjogewogICAgICAgICAgICAgICAgImFjY291bnQiOiBbCiAgICAgICAgICAgICAgICAgICAgIm1hbmFnZS1hY2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAidmlldy1wcm9maWxlIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICAibm90QmVmb3JlIjogMCwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiLAogICAgICAgICAgICAgICAgIi9NYXJrZXRpbmciLAogICAgICAgICAgICAgICAgIi9TYWxlcyIKICAgICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAidXNlcm5hbWUiOiAicXVpbm4iLAogICAgICAgICAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAgICAgICAgICJlbWFpbFZlcmlmaWVkIjogdHJ1ZSwKICAgICAgICAgICAgImZpcnN0TmFtZSI6ICJRdWlubiIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJMZWVtaW5nIiwKICAgICAgICAgICAgImVtYWlsIjogInF1aW5uQHFsaWsuZXhhbXBsZSIsCiAgICAgICAgICAgICJjcmVkZW50aWFscyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXNzd29yZCIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInh4eHh4IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVxdWlyZWRBY3Rpb25zIjogWwogICAgICAgICAgICAgICAgIlVQREFURV9QQVNTV09SRCIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlYWxtUm9sZXMiOiBbCiAgICAgICAgICAgICAgICAidXNlciIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNsaWVudFJvbGVzIjogewogICAgICAgICAgICAgICAgImFjY291bnQiOiBbCiAgICAgICAgICAgICAgICAgICAgIm1hbmFnZS1hY2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAidmlldy1wcm9maWxlIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICAibm90QmVmb3JlIjogMCwKICAgICAgICAgICAgImdyb3VwcyI6IFsKICAgICAgICAgICAgICAgICIvQWNjb3VudGluZyIsCiAgICAgICAgICAgICAgICAiL0V2ZXJ5b25lIgogICAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJyb290YWRtaW4iLAogICAgICAgICAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAgICAgICAgICJlbWFpbFZlcmlmaWVkIjogdHJ1ZSwKICAgICAgICAgICAgImZpcnN0TmFtZSI6ICJSb290IiwKICAgICAgICAgICAgImxhc3ROYW1lIjogIkFkbWluIiwKICAgICAgICAgICAgImVtYWlsIjogInJvb3RhZG1pbkBxbGlrLmV4YW1wbGUiLAogICAgICAgICAgICAiY3JlZGVudGlhbHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ4eHh4eCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkQWN0aW9ucyI6IFsKICAgICAgICAgICAgICAgICJVUERBVEVfUEFTU1dPUkQiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZWFsbVJvbGVzIjogWwogICAgICAgICAgICAgICAgInVzZXIiLAogICAgICAgICAgICAgICAgImFkbWluIgogICAgICAgICAgICBdLAogICAgICAgICAgICAiY2xpZW50Um9sZXMiOiB7CiAgICAgICAgICAgICAgICAiYWNjb3VudCI6IFsKICAgICAgICAgICAgICAgICAgICAicmVhbG0tYWRtaW4iCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJub3RCZWZvcmUiOiAwLAogICAgICAgICAgICAiZ3JvdXBzIjogWwogICAgICAgICAgICAgICAgIi9BZG1pbmlzdHJhdG9ycyIsCiAgICAgICAgICAgICAgICAiL0V2ZXJ5b25lIgogICAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJzaWJ5bGxhIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiU2lieWxsYSIsCiAgICAgICAgICAgICJsYXN0TmFtZSI6ICJNZWFkb3dzIiwKICAgICAgICAgICAgImVtYWlsIjogInNpYnlsbGFAcWxpay5leGFtcGxlIiwKICAgICAgICAgICAgImNyZWRlbnRpYWxzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInBhc3N3b3JkIiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAieHh4eHgiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZXF1aXJlZEFjdGlvbnMiOiBbCiAgICAgICAgICAgICAgICAiVVBEQVRFX1BBU1NXT1JEIgogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVhbG1Sb2xlcyI6IFsKICAgICAgICAgICAgICAgICJ1c2VyIgogICAgICAgICAgICBdLAogICAgICAgICAgICAiY2xpZW50Um9sZXMiOiB7CiAgICAgICAgICAgICAgICAiYWNjb3VudCI6IFsKICAgICAgICAgICAgICAgICAgICAibWFuYWdlLWFjY291bnQiLAogICAgICAgICAgICAgICAgICAgICJ2aWV3LXByb2ZpbGUiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJncm91cHMiOiBbCiAgICAgICAgICAgICAgICAiL0FjY291bnRpbmciLAogICAgICAgICAgICAgICAgIi9FdmVyeW9uZSIKICAgICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAidXNlcm5hbWUiOiAic2ltIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZW1haWxWZXJpZmllZCI6IHRydWUsCiAgICAgICAgICAgICJmaXJzdE5hbWUiOiAiU2ltIiwKICAgICAgICAgICAgImxhc3ROYW1lIjogIkNsZWF0b24iLAogICAgICAgICAgICAiZW1haWwiOiAic2ltQHFsaWsuZXhhbXBsZSIsCiAgICAgICAgICAgICJjcmVkZW50aWFscyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJwYXNzd29yZCIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInh4eHh4IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVxdWlyZWRBY3Rpb25zIjogWwogICAgICAgICAgICAgICAgIlVQREFURV9QQVNTV09SRCIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlYWxtUm9sZXMiOiBbCiAgICAgICAgICAgICAgICAidXNlciIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNsaWVudFJvbGVzIjogewogICAgICAgICAgICAgICAgImFjY291bnQiOiBbCiAgICAgICAgICAgICAgICAgICAgIm1hbmFnZS1hY2NvdW50IiwKICAgICAgICAgICAgICAgICAgICAidmlldy1wcm9maWxlIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICAiZ3JvdXBzIjogWwogICAgICAgICAgICAgICAgIi9BY2NvdW50aW5nIiwKICAgICAgICAgICAgICAgICIvRXZlcnlvbmUiCiAgICAgICAgICAgIF0KICAgICAgICB9CiAgICBdLAogICAgImNsaWVudHMiOiBbCiAgICAgICAgewogICAgICAgICAgICAiY2xpZW50SWQiOiAiZWRnZS1hdXRoIiwKICAgICAgICAgICAgImVuYWJsZWQiOiB0cnVlLAogICAgICAgICAgICAiZGlyZWN0QWNjZXNzR3JhbnRzRW5hYmxlZCI6IHRydWUsCiAgICAgICAgICAgICJjbGllbnRBdXRoZW50aWNhdG9yVHlwZSI6ICJjbGllbnQtc2VjcmV0IiwKICAgICAgICAgICAgInNlY3JldCI6ICJ4eHh4IiwKICAgICAgICAgICAgInJlZGlyZWN0VXJpcyI6IFsKICAgICAgICAgICAgICAgICIqIgogICAgICAgICAgICBdLAogICAgICAgICAgICAicHVibGljQ2xpZW50IjogZmFsc2UsCiAgICAgICAgICAgICJwcm90b2NvbCI6ICJvcGVuaWQtY29ubmVjdCIsCiAgICAgICAgICAgICJwcm90b2NvbE1hcHBlcnMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiZ3JvdXBzIiwKICAgICAgICAgICAgICAgICAgICAicHJvdG9jb2wiOiAib3BlbmlkLWNvbm5lY3QiLAogICAgICAgICAgICAgICAgICAgICJwcm90b2NvbE1hcHBlciI6ICJvaWRjLWdyb3VwLW1lbWJlcnNoaXAtbWFwcGVyIiwKICAgICAgICAgICAgICAgICAgICAiY29uZmlnIjogewogICAgICAgICAgICAgICAgICAgICAgICAiZnVsbC5wYXRoIjogImZhbHNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImlkLnRva2VuLmNsYWltIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiYWNjZXNzLnRva2VuLmNsYWltIjogInRydWUiLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhaW0ubmFtZSI6ICJncm91cHMiLAogICAgICAgICAgICAgICAgICAgICAgICAidXNlcmluZm8udG9rZW4uY2xhaW0iOiAidHJ1ZSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkNsaWVudCBJUCBBZGRyZXNzIiwKICAgICAgICAgICAgICAgICAgICAicHJvdG9jb2wiOiAib3BlbmlkLWNvbm5lY3QiLAogICAgICAgICAgICAgICAgICAgICJwcm90b2NvbE1hcHBlciI6ICJvaWRjLXVzZXJzZXNzaW9ubW9kZWwtbm90ZS1tYXBwZXIiLAogICAgICAgICAgICAgICAgICAgICJjb25maWciOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ1c2VyLnNlc3Npb24ubm90ZSI6ICJjbGllbnRBZGRyZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYWltLm5hbWUiOiAiY2xpZW50QWRkcmVzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpZC50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFjY2Vzcy50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImpzb25UeXBlLmxhYmVsIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkNsaWVudCBJRCIsCiAgICAgICAgICAgICAgICAgICAgInByb3RvY29sIjogIm9wZW5pZC1jb25uZWN0IiwKICAgICAgICAgICAgICAgICAgICAicHJvdG9jb2xNYXBwZXIiOiAib2lkYy11c2Vyc2Vzc2lvbm1vZGVsLW5vdGUtbWFwcGVyIiwKICAgICAgICAgICAgICAgICAgICAiY29uZmlnIjogewogICAgICAgICAgICAgICAgICAgICAgICAidXNlci5zZXNzaW9uLm5vdGUiOiAiY2xpZW50SWQiLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhaW0ubmFtZSI6ICJjbGllbnRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpZC50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFjY2Vzcy50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImpzb25UeXBlLmxhYmVsIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkNsaWVudCBIb3N0IiwKICAgICAgICAgICAgICAgICAgICAicHJvdG9jb2wiOiAib3BlbmlkLWNvbm5lY3QiLAogICAgICAgICAgICAgICAgICAgICJwcm90b2NvbE1hcHBlciI6ICJvaWRjLXVzZXJzZXNzaW9ubW9kZWwtbm90ZS1tYXBwZXIiLAogICAgICAgICAgICAgICAgICAgICJjb25maWciOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ1c2VyLnNlc3Npb24ubm90ZSI6ICJjbGllbnRIb3N0IiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYWltLm5hbWUiOiAiY2xpZW50SG9zdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpZC50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFjY2Vzcy50b2tlbi5jbGFpbSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImpzb25UeXBlLmxhYmVsIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICB9CiAgICBdCn0=
kind: Secret
metadata:
  labels:
    app: keycloak
    release: qliksense
  name: qliksense-keycloak-realm-g7g58gk675
  namespace: default
type: Opaque
---
apiVersion: v1
data:
  clientSecret: eHh4eHg=
  defaultUserPassword: eHh4eHg=
  password: eHh4eHg=
  postgresqlPassword: eHh4eHg=
  something: ZWxzZQ==
kind: Secret
metadata:
  labels:
    app: keycloak
    release: qliksense
  name: qliksense-keycloak-secrets-mbg282297b
  namespace: default
type: Opaque
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
    service: headless
  name: qliksense-keycloak-headless
  namespace: default
spec:
  clusterIP: None
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  selector:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/name: keycloak
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
    service: http
  name: qliksense-keycloak-http
  namespace: default
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  selector:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/name: keycloak
  type: NodePort
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
  name: qliksense-keycloak
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
      app.kubernetes.io/instance: qliksense
      app.kubernetes.io/name: keycloak
  serviceName: qliksense-keycloak-headless
  template:
    metadata:
      annotations:
        checksum/config-sh: 5aee0686bc0df7b819569f71611a0f54498802136057e3a607f1d407a582043e
        checksum/config-startup: 022e615cc24dacb5a1427487f9a7308c5f2e8b849533a90c795290f652e809f3
      labels:
        app: keycloak
        app.kubernetes.io/instance: qliksense
        app.kubernetes.io/name: keycloak
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: role
                  operator: NotIn
                  values:
                  - test
                matchLabels:
                  app: keycloak
                  app.kubernetes.io/instance: qliksense
                  app.kubernetes.io/name: keycloak
              topologyKey: failure-domain.beta.kubernetes.io/zone
            weight: 100
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: role
                operator: NotIn
                values:
                - test
              matchLabels:
                app: keycloak
                app.kubernetes.io/instance: qliksense
                app.kubernetes.io/name: keycloak
            topologyKey: kubernetes.io/hostname
      containers:
      - command:
        - /scripts/keycloak.sh
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              key: postgresqlPassword
              name: qliksense-keycloak-secrets-mbg282297b
        - name: KEYCLOAK_USER
          value: keycloak
        - name: KEYCLOAK_PASSWORD_FILE
          value: /secrets/password
        - name: JAVA_TOOL_OPTIONS
          value: -XX:+UseContainerSupport -XX:MaxRAMPercentage=50.0
        - name: PROXY_ADDRESS_FORWARDING
          value: "true"
        - name: DB_VENDOR
          value: h2
        image: jboss/keycloak:9.0.2
        imagePullPolicy: IfNotPresent
        lifecycle: null
        livenessProbe:
          httpGet:
            path: /auth/
            port: http
          initialDelaySeconds: 300
          timeoutSeconds: 5
        name: main
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 8443
          name: https
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /auth/realms/master
            port: http
          initialDelaySeconds: 30
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
          runAsUser: 1000
        volumeMounts:
        - mountPath: /scripts
          name: sh
          readOnly: true
        - mountPath: /secrets
          name: secrets
          readOnly: true
        - mountPath: /opt/jboss/startup-scripts
          name: startup
          readOnly: true
        - mountPath: /realm/
          name: realm
          readOnly: true
        - mountPath: /opt/jboss/keycloak/themes/qliktheme
          name: theme
      initContainers:
      - args:
        - -c
        - |
          echo "Copying theme..."
          cp -R /qliktheme/* /theme
        command:
        - sh
        image: bkuschel/qlik-keycloak-theme:5.1.0
        imagePullPolicy: IfNotPresent
        name: theme-provider
        volumeMounts:
        - mountPath: /theme
          name: theme
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
      serviceAccountName: default
      terminationGracePeriodSeconds: 60
      volumes:
      - configMap:
          defaultMode: 365
          name: qliksense-keycloak-sh
        name: sh
      - name: secrets
        secret:
          secretName: qliksense-keycloak-secrets-mbg282297b
      - configMap:
          defaultMode: 365
          name: qliksense-keycloak-startup
        name: startup
      - name: realm
        secret:
          secretName: qliksense-keycloak-realm-g7g58gk675
      - emptyDir: {}
        name: theme
  updateStrategy:
    type: RollingUpdate
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:eu-west-1:812117193213:certificate/b709fa40-ad89-49f3-ac27-318781fcb99b
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    alb.ingress.kubernetes.io/scheme: internet-facing
    # kubernetes.io/ingress.global-static-ip-name: keycloak-ip
    # networking.gke.io/managed-certificates: qliksense-keycloak
  labels:
    app: keycloak
    app.kubernetes.io/instance: qliksense
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-7.6.0
    release: qliksense
  name: qliksense-keycloak
  namespace: default
spec:
  rules:
  - host: keycloak.devqseok.tk
    http:
      paths:
      - backend:
          serviceName: qliksense-keycloak-http
          servicePort: http
        path: /*
# ---
# apiVersion: networking.gke.io/v1beta1
# kind: ManagedCertificate
# metadata:
#   labels:
#     app: keycloak
#     release: qliksense
#   name: qliksense-keycloak
#   namespace: default
# spec:
#   domains:
#   - keycloak.devqseok.tk
